[TOC]

# Qt大作业41组作业报告

组员： 王骏达、 孟凡荣

## 程序功能介绍

我们开发的游戏Oliver是一个第三人称剧情向解谜游戏，玩家在各个地点探索，与不同人物的对话，阅读作者留下的线索，理解故事、收集宝物、获得能力，最终迎战boss，走向结局。

地图上有若里村，放逐之地，火焰谷，极寒之地四个可到达地点。每个地点中有一些小地点，道具以及NPC。若里村是初始地点，放逐之地是最终地图。劳斯镇，谷比恩和灵魂圣地是提示性地点以及展示设定。

主界面是带有特效的初始画面以及背景音乐，背景随现实时间改变。玩家点击开始游戏后会得到故事背景的提示。玩家可以随时跳转到不同地图（有条件限制以及提示）或在同一地图内去不同地点探索。点击玩家头像可以查看当前能力、物品等状态，点击上方选项可以存档并退出或者查看设置，点击帮助可以查看提示以及游戏设定。左下角展示玩家所在地点。获得一些物品或者能力提升是进入其他地点的先决条件，其中部分需要完成解谜任务。游戏内画面包括不同的音效，场景图片，动效以及跳转时的进度条。当玩家前往最终地点时，玩家状态不同会通往不同的结局（3种）。

## 项目模块与类设计细节

模块包括开始界面模块，音效模块，文件加载模块，对话展示模块，人物状态展示模块，背景与动效模块，地图间跳转模块，场景模块。

开始界面模块包括Mainwindow类，实现了界面初始化，资源加载等功能。其中init_window函数实现窗口初始化（包括获取时间，初始化窗口及背景，初始化按钮位置，显示游戏名称）。之后依次加载背景及音乐资源，创建若里村子窗口，设置音乐播放器。另有2个子函数分别实现更换开始界面背景以及检测开始界面的鼠标事件并更换背景图片。Mainwindow类有4个槽函数，分别对应开始游戏，继续游戏，设置，退出4个按钮。开始游戏即创建新游戏，继续游戏加载二进制文件继续游戏，设置可以调节音量，退出即退出游戏。

音乐模块包括effectaudio类。该类通过QThread,QSoundeffect等QT自带类实现了音效播放的功能。该类包括4个子函数，分别实现音效播放（传入不同voice_type信号播放不同音效），次数设置，停止以及设置音量。

文件加载模块包括file类。Setfile函数实现存档（二进制文件），init_by_file函数实现读取（二进制文件）。其中读取以及存档的内容是人物对所有有关地点的访问状态以及获取能力，武器，魔法的状态。

对话展示模块包括dialog,dialogue类。Dialog类实现了对话框，包括两个槽函数对应继续与退出两个按钮。初始化包括窗口设置（有背景），位置设置以及计时器设置。Set_text函数实现类似输入流功能，show_act函数实现将输入流中的内容以逐行浮现形式展现，通过计时器计时并以一定速度输出，通过pos,roll_sum等参数控制输出位置，并且一页仅展示一部分内容，点击继续展示下一部分内容。Dialogue类包括游戏所有文字内容（约5k字）。

人物状态展示模块包括Oliver类以及status_show类。Oliver类构造函数的一部分实现了设置人物以及头像按钮，status_show类则会在点击头像后的对话框中通过存储的状态展示对应的人物状态。

背景与动效模块由set_context类实现。Set_context函数设置窗口背景，grad_animation实现线型动效,set_button _context,set_status设置按钮背景。

地图间跳转模块由load类与map实现。load类会展示一个含有进度条和文字的对话框，可视化跳转过程。进度条与实际加载进度无关，由qtimer计时控制进度。Map类则实现地图上某区域被点击后更新位置（pos）,更新背景音乐，展示进度条，对特殊的窗口执行额外操作，上个窗口关闭，下个窗口打开等功能。

场景模块包括banished,rolig_village,iceplace, fire,end,settings,shop,getmagic,getsword,iceiron,information,ironmanhouse,magichouse,outsea,pass,rolig_sea等类。End类展示结局之后的作者的话，有背景音乐。settings设置包含作者的话，一个可调音量进度条，一个装饰进度条。Banished,fire,iceplace,rolig_village分别对应放逐之地，火焰谷，极寒之地，若里村的背景场景实现，小地点展示以及状态更新。Getmagic类，getsword类对应获得魔法，获得武器（展示对话框，更新状态，检查是否有更高等级状态）。Iceiron对应极寒之地中的宝箱（展示对话框，检查宝物是否被取走）。Information是游戏开始时展示的对话框（背景图片与文字）,magichouse是若里村中魔法屋。Outsea,rolig_sea类包括若里村遇到渔夫后行动内容。Pass实现火焰谷中解谜（密码）场景。

## 分工

王骏达负责了图片及音乐资源，音效动效背景的实现以及所有模块代码的实现。

孟凡荣负责了文字内容部分。

架构设计，作业报告及内容设计共同完成。

## 项目总结与反思
